<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#2196F3">
  <title>Meeting Scheduler with Mixmax - Dashboard</title>
  <style type="text/css">
  html,
  body,
  .container-table {
    height: 100%;
  }
  
  .container-table {
    display: table;
  }
  
  .vertical-center-row {
    display: table-cell;
    vertical-align: middle;
  }
  </style>
  <!-- CSS  -->
  <link href="min/plugin-min.css" type="text/css" rel="stylesheet">
  <link href="min/custom-min.css" type="text/css" rel="stylesheet">
</head>

<body id="top" class="grey lighten-5">
  <div class="container container-table">
    <div class="row vertical-center-row">
      <div class="col s12 m8 offset-m2">
        <div class="card">
          <div class="progress blue lighten-2" style="margin:0px;display:none;" id="progressBar">
            <div class="indeterminate blue"></div>
          </div>
          <div class="card-content grey-text">
            <h4 class="card-title black-text center">Set Preferences</h4>
            <div class="row">
              <form class="col s12">
                <div class="row">
                  <div class="input-field col s12">
                    <input id="city_name" type="text" class="validate">
                    <label for="city_name">Enter your city name</label>
                  </div>
                </div>
                <div class="row">
                  <div class="input-field col s6">
                    <select id="start_time">
                      <option value="" disabled selected>When do you start your day?</option>
                      <option value="00:00">00:00</option>
                      <option value="00:30">00:30</option>
                      <option value="01:00">01:00</option>
                      <option value="01:30">01:30</option>
                      <option value="02:00">02:00</option>
                      <option value="02:30">02:30</option>
                      <option value="03:00">03:00</option>
                      <option value="03:30">03:30</option>
                      <option value="04:00">04:00</option>
                      <option value="04:30">04:30</option>
                      <option value="05:00">05:00</option>
                      <option value="05:30">05:30</option>
                      <option value="06:00">06:00</option>
                      <option value="06:30">06:30</option>
                      <option value="07:00">07:00</option>
                      <option value="07:30">07:30</option>
                      <option value="08:00">08:00</option>
                      <option value="08:30">08:30</option>
                      <option value="09:00">09:00</option>
                      <option value="09:30">09:30</option>
                      <option value="10:00">10:00</option>
                      <option value="10:30">10:30</option>
                      <option value="11:00">11:00</option>
                      <option value="11:30">11:30</option>
                      <option value="12:00">12:00</option>
                      <option value="12:30">12:30</option>
                      <option value="13:00">13:00</option>
                      <option value="13:30">13:30</option>
                      <option value="14:00">14:00</option>
                      <option value="14:30">14:30</option>
                      <option value="15:00">15:00</option>
                      <option value="15:30">15:30</option>
                      <option value="16:00">16:00</option>
                      <option value="16:30">16:30</option>
                      <option value="17:00">17:00</option>
                      <option value="17:30">17:30</option>
                      <option value="18:00">18:00</option>
                      <option value="18:30">18:30</option>
                      <option value="19:00">19:00</option>
                      <option value="19:30">19:30</option>
                      <option value="20:00">20:00</option>
                      <option value="20:30">20:30</option>
                      <option value="21:00">21:00</option>
                      <option value="21:30">21:30</option>
                      <option value="22:00">22:00</option>
                      <option value="22:30">22:30</option>
                      <option value="23:00">23:00</option>
                      <option value="23:30">23:30</option>
                    </select>
                  </div>
                  <div class="input-field col s6">
                    <select id="end_time">
                      <option value="" disabled selected>When do you end your day?</option>
                      <option value="00:00">00:00</option>
                      <option value="00:30">00:30</option>
                      <option value="01:00">01:00</option>
                      <option value="01:30">01:30</option>
                      <option value="02:00">02:00</option>
                      <option value="02:30">02:30</option>
                      <option value="03:00">03:00</option>
                      <option value="03:30">03:30</option>
                      <option value="04:00">04:00</option>
                      <option value="04:30">04:30</option>
                      <option value="05:00">05:00</option>
                      <option value="05:30">05:30</option>
                      <option value="06:00">06:00</option>
                      <option value="06:30">06:30</option>
                      <option value="07:00">07:00</option>
                      <option value="07:30">07:30</option>
                      <option value="08:00">08:00</option>
                      <option value="08:30">08:30</option>
                      <option value="09:00">09:00</option>
                      <option value="09:30">09:30</option>
                      <option value="10:00">10:00</option>
                      <option value="10:30">10:30</option>
                      <option value="11:00">11:00</option>
                      <option value="11:30">11:30</option>
                      <option value="12:00">12:00</option>
                      <option value="12:30">12:30</option>
                      <option value="13:00">13:00</option>
                      <option value="13:30">13:30</option>
                      <option value="14:00">14:00</option>
                      <option value="14:30">14:30</option>
                      <option value="15:00">15:00</option>
                      <option value="15:30">15:30</option>
                      <option value="16:00">16:00</option>
                      <option value="16:30">16:30</option>
                      <option value="17:00">17:00</option>
                      <option value="17:30">17:30</option>
                      <option value="18:00">18:00</option>
                      <option value="18:30">18:30</option>
                      <option value="19:00">19:00</option>
                      <option value="19:30">19:30</option>
                      <option value="20:00">20:00</option>
                      <option value="20:30">20:30</option>
                      <option value="21:00">21:00</option>
                      <option value="21:30">21:30</option>
                      <option value="22:00">22:00</option>
                      <option value="22:30">22:30</option>
                      <option value="23:00">23:00</option>
                      <option value="23:30">23:30</option>
                    </select>
                  </div>
                </div>
                <div class="row">
                  <div class="input-field col s12">
                    <input value="4" id="days_number" type="text" class="validate">
                    <label for="days_number">How many days you want to suggest?</label>
                  </div>
                </div>
                <div class="row">
                  <div class="input-field col s12">
                    <input value="3" id="slot_number" type="text" class="validate">
                    <label for="slot_number">How many slots do you want to suggest?</label>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div class="row center">
            <a class="waves-effect waves-light btn-large blue center" id="btnSubmit">Save Perference</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--  Scripts-->
  <script src="min/plugin-min.js"></script>
  <script src="min/custom-min.js"></script>
  <script>
  var userTimezone;

  function initAutocomplete() {
    var user_input = /** @type {!HTMLInputElement} */ (
      document.getElementById('city_name'));
    // Overwrite Google default placeholders
    user_input.placeholder = ""
    var user_autocomplete = new google.maps.places.Autocomplete(user_input, {
      types: ['(cities)']
    });
    user_autocomplete.addListener('place_changed', function() {
      var place = user_autocomplete.getPlace();
      $.ajax({
        url: 'https://api.timezonedb.com/?lat=' + place.geometry.location.lat() + '&lng=' + place.geometry.location.lng() + '&key=I16KGCYBRXQ8&format=json',
        success: function(data) {
          userTimezone = data.zoneName
          console.log(userTimezone)
        }
      });
    })
  }
  $(document).ready(function() {
    $("#btnSubmit").click(function() {
      var jsonObject = {
        city: $("#city_name").val(),
        timezone: userTimezone,
        user_start_time: $("#start_time").val(),
        user_end_time: $("#end_time").val(),
        config_days: $("#days_number").val(),
        config_slots: $("#slot_number").val()
      }
      if (jsonObject.city && jsonObject.user_start_time && jsonObject.user_end_time && jsonObject.config_days && jsonObject.config_slots) {
        $("#progressBar").show()
        $.ajax({
          type: 'POST',
          url: 'https://127.0.0.1:3000/preference',
          data: jsonObject,
          dataType: 'json',
          success: function(data) {
            console.log(data)
            $("#progressBar").hide()
            Materialize.toast('Your preferences has been set succesfully!', 8000)
          }
        })
      } else {
        Materialize.toast('Error! Please enter all the fields!', 8000)
      }
    });
  });
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBxyDwTMxzB40JWvxiHDGH7rlIOoE5eU4&libraries=places&callback=initAutocomplete" async defer></script>
</body>

</html>
